## `filtering` - scripts for mutation filtering

Variant calling is described in `log.md` and requires GATK HaplotypeCaller.

- Filter initial variant calls - `filter_candidate_muts.py`

This script filters first pass variant calls (see `log.md`). The criteria
are 1) GQ >= 30; 2) all calls are 'homozygous' (see Methods); 3) mutated
allele is only present in one line; 4) sample with mutated site has <2
reads containing the non-mutated allele. This script was used on the Salt MA
mutation lines specifically. 

- GQ distributions - `gq_test.py` and `gq_analysis.Rmd`

`gq_test.py` generates 'human readable' lists of mutations for manual examination.
(See `mutation_snapshots.py` below). The distribution of GQ scores was examined in
`gq_analysis.Rmd`. 

- Generate IGV screenshots of putative mutation calls -  `mutation_snapshots.py`

This script takes in output from `filter_candidate_muts.py` and spawns a non-GUI
instance of IGV on the server. It then auto-generates a temp batch script that
IGV uses to generate screenshots of each mutation (alongside surrounding 100 bp).
These screenshots can then be used for manual curation and assessment of mutations. 

The script requires that an Xvfb 'X server' is running to avoid having to use X11
forwarding (which would stream a very slow GUI-based instance of IGV). 

To run Xvfb: `./path/to/Xvfb :1 -nolisten tcp -fp /path/to/X11/fonts/misc`

Huge thanks to [this anonymous blog post](http://thedusseldorfer.blogspot.com/2013/09/remotely-plotting-with-igv-even-without.html) for making this script possible! 

- Export filtered bams for offline viewing in IGV - `export_IGV.py`

This script takes in a tab-separated file containing mutation calls
and returns filtered BAMs for offline IGV viewing. This is useful for cases where
the surrounding 100 bp is not sufficient to make judgements off of. 
The script itself is mostly a wrapper around `samtools view` that reads directly
from mutation lists generated by `filter_candidate_muts.py`. 

(I now use `sshfs`, which makes this much easier! Uploading this script
for posterity) 

- Generate detailed mutation tables - `mut_describer.py`

Given a table of mutations, creates a detailed table for each mutation
containing information about the genomic annotation, fold degeneracy, gene
name (if applicable), and more. Requires in-house script and annotation
table from the Ness lab server. 


